<!-- templates/admin/user_detail.html -->
{% extends "admin/base.html" %}
{% block page_title %}User Detail{% endblock %}
{% block content %}
<div class="row g-3">
    <div class="col-md-4">
        <div class="table-card">
            <h5 class="mb-3">User Information</h5>
            <dl class="row">
                <dt class="col-sm-5">Phone</dt>
                <dd class="col-sm-7">{{ user.phone_number }}</dd>
                
                <dt class="col-sm-5">First Seen</dt>
                <dd class="col-sm-7">{{ user.first_interaction.strftime('%d/%m/%Y %H:%M') }}</dd>
                
                <dt class="col-sm-5">Last Seen</dt>
                <dd class="col-sm-7">{{ user.last_interaction.strftime('%d/%m/%Y %H:%M') }}</dd>
                
                <dt class="col-sm-5">Total Messages</dt>
                <dd class="col-sm-7"><span class="badge bg-primary">{{ user.total_messages }}</span></dd>
            </dl>
            
            {% if session_info %}
            <hr>
            <h6>Current Session</h6>
            <p class="mb-1"><small class="text-muted">Category:</small> {{ session_info.current_category or '-' }}</p>
            <p class="mb-0"><small class="text-muted">Last Layanan:</small> {{ session_info.current_layanan or '-' }}</p>
            {% endif %}
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="table-card">
            <h5 class="mb-3">Message History</h5>
            <div style="max-height: 600px; overflow-y: auto;">
                {% for msg in messages %}
                <div class="card mb-2 {% if msg.direction == 'incoming' %}border-info{% else %}border-success{% endif %}">
                    <div class="card-body py-2">
                        <div class="d-flex justify-content-between">
                            <span class="badge badge-direction-{{ msg.direction }}">{{ msg.direction }}</span>
                            <small class="text-muted">{{ msg.timestamp.strftime('%d/%m/%Y %H:%M:%S') }}</small>
                        </div>
                        <p class="mb-0 mt-2">{{ msg.content or '(Interactive Message)' }}</p>
                        <small class="text-muted">Type: {{ msg.message_type }}</small>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    <a href="{{ url_for('admin.users') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Back to Users
    </a>
</div>
{% endblock %}
